<h2>
  {{ event.name }}
</h2>
<h3>
  {{ event.date|date:"d.m.Y" }}
</h3>

<form action="{% url "event-vote" uuid=event.uuid %}" method="POST">
  {% csrf_token %}
  <label>
    Who are you?
    <input
      id="username-input"
      type="text"
      name="username"
      required
      value="{{ last_username }}"
      onchange="gameDoodle.storeLastUsernameInLocalStorage(event)"
    >
  </label>
  <ol>
    {% for game in games %}
    <li>
      {{ game.name }}
      <button
        type="submit"
        value="{{ game.id }}"
        name="game_id"
      >
        +
      </button>
      <div>
        {% for vote in game.votes %}
          <button
            class="vote"
            type="submit"
            value="{{ vote.id }}"
            name="vote_id"
          >
            -
          </button>
          {{ vote.username }}
        </button>{% if not forloop.last%}, {% endif %}
        {% endfor %}
      </div>
    </li>
    {% empty %}
    No games yet
    {% endfor %}
  </ol>
</form>

<script>
  var gameDoodle = (function() {
    return {
      lastUsernameFromSession: '{{ last_username }}',
      storeLastUsernameInLocalStorage: function(event) {
        localStorage.setItem('gamedoodle__last_username', event.target.value);
      }
    };
  })();

  if (!gameDoodle.lastUsernameFromSession) {
    var input = document.getElementById('username-input');
    input.value = localStorage.getItem('gamedoodle__last_username') || '';
  }
</script>
